load "includes/cstdio"
load "includes/cstdlib"

def change(x s64*) void
    *x = 53

def v2
    x f64
    y f64

def main(argc int, argv char**) s64
    i = 1
    k = &i
    *k = 42

    # Print all arguments
    for x = 0 x < argc ++x
        printf("%s\n", *(argv + sizeof(**argv) * x))
        printf("%s\n", argv[x])

    # argv[x]
    # is syntax sugar for
     #*(argv + sizeof(*argv) * x)


    # The bug is that 'v.x' type is seen as 'v2' when it should be 'f64'
    # Check the assembly.

    v v2
    v.x = 53.35
    *(&v + 8) = 14.01
    f = 3.0
    printf("v.x = %f v.x = %f\n", v.x, v.y)

    x = 5.0
    f = 3.0
    printf("f = %f x = %f\n", f, x)

    change(k)
    return i
